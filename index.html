<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Studio Audio • Vicenza — Prenota</title>
  <meta name="description" content="Prenota una sessione col producer o affitta la stanzetta a ore. Booking diretto via Google Calendar." />
  <style>
    :root{--bg:#0f1115;--panel:#151923;--text:#e7ecf5;--muted:#93a0b8;--accent:#58d0c6;--radius:16px}
    *{box-sizing:border-box}
    body{margin:0;background:#0f1115;color:var(--text);font-family:Inter,system-ui,Segoe UI,Arial,sans-serif}
    header{padding:20px 24px;border-bottom:1px solid #1f2633;background:#0f131c;position:sticky;top:0}
    header h1{margin:0;font-size:22px}
    header p{margin:6px 0 0;color:var(--muted)}
    main{display:grid;grid-template-columns:1.2fr 1fr;gap:20px;max-width:1200px;margin:20px auto;padding:0 20px}
    @media (max-width:980px){main{grid-template-columns:1fr}}
    .card{background:var(--panel);border:1px solid #232a3a;border-radius:var(--radius);padding:16px}
    .chat{display:flex;flex-direction:column;height:70vh;min-height:520px}
    .chatlog{flex:1;overflow:auto;padding:12px;background:#0d1420;border-radius:12px;border:1px solid #1e2738}
    .row{display:flex;gap:10px;margin-top:10px}
    .input{flex:1;background:#0c111a;border:1px solid #1d2636;border-radius:12px;color:var(--text);padding:12px}
    button{cursor:pointer;border-radius:12px;border:1px solid #2a3448;background:#121a28;color:var(--text);padding:10px 14px}
    button:hover{border-color:#3a4a6a;transform:translateY(-1px)}
    .bubble{max-width:80%;padding:10px 12px;border-radius:14px;line-height:1.45;margin:6px 0;white-space:pre-wrap}
    .bot{background:#182133;border:1px solid #24314a;border-top-left-radius:6px}
    .user{background:#243656;border:1px solid #2d4060;border-top-right-radius:6px;margin-left:auto}
    .time{font-size:11px;color:#8aa0c2;margin-top:2px}
    .quick{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .pill{border:1px dashed #2b3650;background:#131a28;padding:8px 10px;border-radius:999px;font-size:13px}
    .pill:hover{background:#162034}
    .section h3{margin:0 0 8px}
    .small{font-size:13px;color:var(--muted)}
    .calendar iframe{border:0;width:100%;height:600px;border-radius:12px}
    a.link{color:var(--accent);text-decoration:none}
    a.link:hover{text-decoration:underline}
  </style>

  <!-- Google Calendar "scheduling button" (per il popup) -->
  <link href="https://calendar.google.com/calendar/scheduling-button-script.css" rel="stylesheet">
  <script src="https://calendar.google.com/calendar/scheduling-button-script.js" async></script>
</head>
<body>
  <header>
    <h1>Studio Audio • Vicenza</h1>
    <p>Prenota direttamente sul calendario: Sessione col Producer o Affitto Stanzetta.</p>
  </header>

  <main>
    <!-- CHAT GUIDATA (senza backend) -->
    <section class="card chat" aria-label="Chatbot prenotazioni">
      <div id="chatlog" class="chatlog" role="log" aria-live="polite"></div>
      <div id="quick" class="quick"></div>
      <div class="row">
        <input id="input" class="input" placeholder="Scrivi qui… (Invio per inviare)" autocomplete="off" />
        <button id="send">Invia</button>
      </div>
      <p class="small">Il bot ti porta alla pagina ufficiale di prenotazione di Google Calendar (disponibilità sempre aggiornata).</p>
    </section>

    <!-- SEZIONE BOOKING -->
    <aside class="card">
      <h3>Prenota subito</h3>
      <p class="small">Apri le pagine di prenotazione (link) o usa il pulsante con popup. Sotto trovi anche l’embed inline.</p>

      <!-- Link diretti -->
      <p>
        <!-- SESSIONE COL PRODUCER (link pubblico) -->
        <a class="link" id="bookProducer" href="https://calendar.google.com/calendar/appointments/schedules/AcZssZ35XKkoq4STBVRs0s7OfnYur9gnnDQG1LzkUR72RFjFsqwHefJL20ky4vkpD1sMMME4LI8_wGvq?gv=true" target="_blank" rel="noopener">
          Sessione col Producer — apri la pagina
        </a><br/>

        <!-- STANZETTA (TODO: sostituisci appena crei la pagina) -->
        <a class="link" id="bookRoom" href="TODO_LINK_BOOKING_STANZETTA" target="_blank" rel="noopener">
          Affitto Stanzetta a ore — apri la pagina
        </a>
      </p>

      <!-- Pulsante con popup (ufficiale Google) -->
      <div style="margin:12px 0">
        <span id="gcButtonTarget"></span>
      </div>

      <h3 style="margin-top:18px">Oppure prenota qui sotto (embed inline)</h3>
      <div class="calendar" id="embedWrap">
        <!-- SESSIONE COL PRODUCER (iframe inline) -->
        <iframe src="https://calendar.google.com/calendar/appointments/schedules/AcZssZ35XKkoq4STBVRs0s7OfnYur9gnnDQG1LzkUR72RFjFsqwHefJL20ky4vkpD1sMMME4LI8_wGvq?gv=true" frameborder="0" loading="lazy"></iframe>

        <!-- STANZETTA (TODO: incolla l’iframe che Calendar ti fornisce) -->
        <!-- TODO_IFRAME_STANZETTA -->
      </div>
    </aside>
  </main>

  <script>
    // Link delle due pagine (producer già impostato; stanzetta TODO)
    const LINKS = {
      // breve alternativo che hai passato: https://calendar.app.google/YMVG5w64Bbibmnqz6
      // uso direttamente l'URL appointments/schedules per evitare redirect:
      producer: "https://calendar.google.com/calendar/appointments/schedules/AcZssZ35XKkoq4STBVRs0s7OfnYur9gnnDQG1LzkUR72RFjFsqwHefJL20ky4vkpD1sMMME4LI8_wGvq?gv=true",
      room: "TODO_LINK_BOOKING_STANZETTA"
    };

    // Chat minimale: porta l’utente al link giusto
    const logEl = document.getElementById('chatlog');
    const inputEl = document.getElementById('input');
    const sendBtn = document.getElementById('send');
    const quickEl = document.getElementById('quick');

    function addBubble(html, who="bot"){
      const wrap = document.createElement('div');
      wrap.innerHTML = `<div class="bubble ${who}">${html}<div class="time">${new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}</div></div>`;
      logEl.appendChild(wrap.firstElementChild); logEl.scrollTop = logEl.scrollHeight;
    }
    const botSay = (t)=>addBubble(t,"bot");
    const userSay = (t)=>addBubble(t,"user");
    const setQuick = (arr=[])=>{
      quickEl.innerHTML=""; arr.forEach(a=>{
        const b=document.createElement('button'); b.className='pill'; b.textContent=a.label; b.onclick=a.onClick; quickEl.appendChild(b);
      });
    };

    function start(){
      botSay("Ciao! Vuoi prenotare una sessione col producer o affittare la stanzetta?");
      setQuick([
        {label:"Sessione col Producer", onClick:()=>go('producer')},
        {label:"Affitto Stanzetta", onClick:()=>go('room')}
      ]);
      inputEl.focus();
    }

    function go(type){
      const url = type==='producer' ? LINKS.producer : LINKS.room;
      userSay(type==='producer' ? "Sessione col Producer" : "Affitto Stanzetta");
      botSay("Perfetto! Ti apro la pagina ufficiale di prenotazione. Scegli data e ora libere e conferma.");
      if(url && url.startsWith("http")) window.open(url, "_blank", "noopener");
      else botSay("Ops, il link non è ancora configurato. Inseriscilo nella sezione 'Prenota subito'.");
      setQuick([
        {label:"Apri di nuovo", onClick:()=>window.open(url,'_blank','noopener')},
        {label:"Torna indietro", onClick:start}
      ]);
    }

    function handleSend(){
      const t = inputEl.value.trim(); if(!t) return;
      userSay(t); inputEl.value="";
      const s=t.toLowerCase();
      if(s.includes("stanz")||s.includes("affitt")) go('room');
      else if(s.includes("produc")||s.includes("session")) go('producer');
      else botSay("Scrivi “sessione” o “stanzetta”, oppure usa i bottoni qui sotto.");
    }

    sendBtn.addEventListener('click', handleSend);
    inputEl.addEventListener('keydown', e=>{ if(e.key==="Enter") handleSend(); });

    // Inizializza il pulsante popup Google Calendar
    window.addEventListener('load', function(){
      if(window.calendar && calendar.schedulingButton){
        calendar.schedulingButton.load({
          url: LINKS.producer,          // booking page “Sessione col Producer”
          color: '#039BE5',
          label: 'Prenota Sessione',
          target: document.getElementById('gcButtonTarget')
        });
      }
    });

    // aggiorna i link in alto
    document.getElementById('bookProducer').href = LINKS.producer;
    document.getElementById('bookRoom').href = LINKS.room;

    start();
  </script>
</body>
</html>
